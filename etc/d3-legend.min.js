// Copyright 2021, Observable Inc.
// Released under the ISC license.
// https://observablehq.com/@d3/color-legend
function Legend(e,{given_svg:t,title:a,tickSize:n=6,width:i=320,height:r=44+n,marginTop:o=18,marginRight:l=10,marginBottom:d=16+n,marginLeft:c=10,ticks:s=i/64,tickFormat:g,tickValues:h}={}){function f(e,a=256){const t=document.createElement("canvas");t.width=a;t.height=1;const n=t.getContext("2d");for(let t=0;t<a;++t){n.fillStyle=e(t/(a-1));n.fillRect(t,0,1,1)}return t}const p=t.attr("width",i).attr("height",r).attr("viewBox",[0,0,i,r]).style("overflow","visible").style("display","block");let m=t=>t.selectAll(".tick line").attr("y1",o+d-r);let u;if(e.interpolate){const y=Math.min(e.domain().length,e.range().length);u=e.copy().rangeRound(d3.quantize(d3.interpolate(c,i-l),y));p.append("image").attr("x",c).attr("y",o).attr("width",i-c-l).attr("height",r-o-d).attr("preserveAspectRatio","none").attr("xlink:href",f(e.copy().domain(d3.quantize(d3.interpolate(0,1),y))).toDataURL())}else if(e.interpolator){u=Object.assign(e.copy().interpolator(d3.interpolateRound(c,i-l)),{range(){return[c,i-l]}});p.append("image").attr("x",c).attr("y",o).attr("width",i-c-l).attr("height",r-o-d).attr("preserveAspectRatio","none").attr("xlink:href",f(e.interpolator()).toDataURL());console.log(u);if(!u.ticks){if(h===undefined){const y=Math.round(s+1);h=d3.range(y).map(t=>d3.quantile(e.domain(),t/(y-1)))}if(typeof g!=="function"){g=d3.format(g===undefined?",f":g)}}}else if(e.invertExtent){const x=e.thresholds?e.thresholds():e.quantiles?e.quantiles():e.domain();const k=g===undefined?t=>t:typeof g==="string"?d3.format(g):g;u=d3.scaleLinear().domain([-1,e.range().length-1]).rangeRound([c,i-l]);p.append("g").selectAll("rect").data(e.range()).join("rect").attr("x",(t,e)=>u(e-1)).attr("y",o).attr("width",(t,e)=>u(e)-u(e-1)).attr("height",r-o-d).attr("fill",t=>t);h=d3.range(x.length);g=t=>k(x[t],t)}else{u=d3.scaleBand().domain(e.domain()).rangeRound([c,i-l]);p.append("g").selectAll("rect").data(e.domain()).join("rect").attr("x",u).attr("y",o).attr("width",Math.max(0,u.bandwidth()-1)).attr("height",r-o-d).attr("fill",e);m=()=>{}}console.log(s);console.log(h);console.log(n);p.append("g").attr("transform",`translate(0,${r-d})`).call(d3.axisBottom(u).ticks(s,typeof g==="string"?g:undefined).tickFormat(typeof g==="function"?g:undefined).tickSize(n).tickValues(h)).call(m).call(t=>t.select(".domain").remove()).call(t=>t.append("text").attr("x",c).attr("y",o+d-r-6).attr("fill","currentColor").attr("text-anchor","start").attr("font-weight","bold").attr("class","title").text(a));return p.node()}
